barplot(hotdogs$Dogs.eaten, names.arg=hotdogs$Year, col=fill_colors, border=NA, space=0.25, xlab="Year", ylab="Hot dogs and buns (HDB) eaten", main="Nathan's Hot Dog Eating Contest Results, 1980-2010")
crime <- read.csv("http://datasets.flowingdata.com/crimeRatesByState-formatted.csv")
stars(crime)
View(crime)
row.names(crime) <- crime$state
crime <- crime[,2:7]
stars(crime, flip.labels=FALSE, key.loc = c(15, 1.5))
View(crime)
stars(crime, flip.labels=FALSE, key.loc = c(15, 1.5), full=FALSE)
stars(crime, flip.labels=FALSE, key.loc = c(15, 1.5), draw.segments=TRUE)
stars(crime, flip.labels=FALSE, key.loc = c(15, 1.5))
d <- data.frame(y = rnorm(20, 9, 2),
group = as.factor(rep(c('Post-FAP', 'Post-DEP'), each = 10)),
id = rep(1:10, 2))
View(d)
load("~/Rplot.png")
setwd("E:\\学习相关\\R\\China-s-Internal-Migrants-and-Their-Lives\\Codes&Datasets\\Class")
library(foreign)
library(reshape2)
library(ggplot2)
raw <- read.dta("class.dta")
raw$s41 <- as.character(raw$s41)
raw$province[raw$migrant==0] <- raw$s41
general <- data.frame(cat=c("MMale", "MFemale", "LMale", "LFemale"))
general$before <- 0
general[1,2] <- mean(raw$a43b[raw$a2=="男"&raw$migrant==1])
general[2,2] <- mean(raw$a43b[raw$a2=="女"&raw$migrant==1])
general[3,2] <- mean(raw$a43b[raw$a2=="男"&raw$migrant==0])
general[4,2] <- mean(raw$a43b[raw$a2=="女"&raw$migrant==0])
general$now <- 0
general[1,3] <- mean(raw$a43a[raw$a2=="男"&raw$migrant==1])
general[2,3] <- mean(raw$a43a[raw$a2=="女"&raw$migrant==1])
general[3,3] <- mean(raw$a43a[raw$a2=="男"&raw$migrant==0])
general[4,3] <- mean(raw$a43a[raw$a2=="女"&raw$migrant==0])
general$later <- 0
general[1,4] <- mean(raw$a43c[raw$a2=="男"&raw$migrant==1])
general[2,4] <- mean(raw$a43c[raw$a2=="女"&raw$migrant==1])
general[3,4] <- mean(raw$a43c[raw$a2=="男"&raw$migrant==0])
general[4,4] <- mean(raw$a43c[raw$a2=="女"&raw$migrant==0])
melt_gen <- melt(general)
View(melt_gen)
melt_gen$var <- 0
melt_gen$var[melt_gen$variable=="before"] <- 10
melt_gen$var[melt_gen$variable=="now"] <- 20
melt_gen$var[melt_gen$variable=="later"] <- 30
melt_gen$var[(melt_gen$sex=="LFemale" | melt_gen$sex=="MFemale")
& melt_gen$variable=="before"] <- 13
melt_gen$var[(melt_gen$sex=="LFemale" | melt_gen$sex=="MFemale")
& melt_gen$variable=="now"] <- 23
melt_gen$var[(melt_gen$sex=="LFemale" | melt_gen$sex=="MFemale")
& melt_gen$variable=="later"] <- 33
ggplot(melt_gen, aes(x=var, y=value, color=cat)) +
geom_step(size=1.5)+
theme(legend.position="right",panel.background = element_rect(fill = "white"),
panel.border= element_blank())
melt_gen$var[(melt_gen$cat=="LFemale" | melt_gen$cat=="MFemale")
& melt_gen$variable=="before"] <- 13
melt_gen$var[(melt_gen$cat=="LFemale" | melt_gen$cat=="MFemale")
& melt_gen$variable=="now"] <- 23
melt_gen$var[(melt_gen$cat=="LFemale" | melt_gen$cat=="MFemale")
& melt_gen$variable=="later"] <- 33
ggplot(melt_gen, aes(x=var, y=value, color=cat)) +
geom_step(size=1.5)+
theme(legend.position="right",panel.background = element_rect(fill = "white"),
panel.border= element_blank())
View(raw)
View(raw)
raw <- read.dta("class.dta")
raw$s41 <- as.character(raw$s41)
raw$province[raw$a221==""] <- raw$s41
raw$province[raw$a221!=""] <- raw$a221
class(raw$a221)
raw$province[raw$province==""] <- raw$a221
raw <- read.dta("class.dta")
raw$s41 <- as.character(raw$s41)
raw$province[raw$a221==""] <- raw$s41
count(raw$a18=="农业户口")
raw <- subset(raw, raw$a18!="农村户口" | raw$a221!="")
raw$s41 <- as.character(raw$s41)
raw$province[raw$a221==""] <- raw$s41
raw <- subset(raw, raw$a18!="农业户口" | raw$a221!="")
general <- data.frame(cat=c("MMale", "MFemale", "LMale", "LFemale"))
general$before <- 0
general[1,2] <- mean(raw$a43b[raw$a2=="男"&raw$migrant==1])
general[2,2] <- mean(raw$a43b[raw$a2=="女"&raw$migrant==1])
general[3,2] <- mean(raw$a43b[raw$a2=="男"&raw$migrant==0])
general[4,2] <- mean(raw$a43b[raw$a2=="女"&raw$migrant==0])
general$now <- 0
general[1,3] <- mean(raw$a43a[raw$a2=="男"&raw$migrant==1])
general[2,3] <- mean(raw$a43a[raw$a2=="女"&raw$migrant==1])
general[3,3] <- mean(raw$a43a[raw$a2=="男"&raw$migrant==0])
general[4,3] <- mean(raw$a43a[raw$a2=="女"&raw$migrant==0])
general$later <- 0
general[1,4] <- mean(raw$a43c[raw$a2=="男"&raw$migrant==1])
general[2,4] <- mean(raw$a43c[raw$a2=="女"&raw$migrant==1])
general[3,4] <- mean(raw$a43c[raw$a2=="男"&raw$migrant==0])
general[4,4] <- mean(raw$a43c[raw$a2=="女"&raw$migrant==0])
melt_gen <- melt(general)
melt_gen$var <- 0
melt_gen$var[melt_gen$variable=="before"] <- 10
melt_gen$var[melt_gen$variable=="now"] <- 20
melt_gen$var[melt_gen$variable=="later"] <- 30
melt_gen$var[(melt_gen$cat=="LFemale" | melt_gen$cat=="MFemale")
& melt_gen$variable=="before"] <- 13
melt_gen$var[(melt_gen$cat=="LFemale" | melt_gen$cat=="MFemale")
& melt_gen$variable=="now"] <- 23
melt_gen$var[(melt_gen$cat=="LFemale" | melt_gen$cat=="MFemale")
& melt_gen$variable=="later"] <- 33
ggplot(melt_gen, aes(x=var, y=value, color=cat)) +
geom_step(size=1.5)+
theme(legend.position="right",panel.background = element_rect(fill = "white"),
panel.border= element_blank())
raw$migrant <-1
raw$migrantp[raw$a221==""] <- 0
raw <- read.dta("class.dta")
raw$s41 <- as.character(raw$s41)
raw$province[raw$a221==""] <- raw$s41
raw <- subset(raw, raw$a18!="农业户口" | raw$a221!="")
raw$migrant <-1
raw$migrant[raw$a221==""] <- 0
general <- data.frame(cat=c("MMale", "MFemale", "LMale", "LFemale"))
general$before <- 0
general[1,2] <- mean(raw$a43b[raw$a2=="男"&raw$migrant==1])
general[2,2] <- mean(raw$a43b[raw$a2=="女"&raw$migrant==1])
general[3,2] <- mean(raw$a43b[raw$a2=="男"&raw$migrant==0])
general[4,2] <- mean(raw$a43b[raw$a2=="女"&raw$migrant==0])
general$now <- 0
general[1,3] <- mean(raw$a43a[raw$a2=="男"&raw$migrant==1])
general[2,3] <- mean(raw$a43a[raw$a2=="女"&raw$migrant==1])
general[3,3] <- mean(raw$a43a[raw$a2=="男"&raw$migrant==0])
general[4,3] <- mean(raw$a43a[raw$a2=="女"&raw$migrant==0])
general$later <- 0
general[1,4] <- mean(raw$a43c[raw$a2=="男"&raw$migrant==1])
general[2,4] <- mean(raw$a43c[raw$a2=="女"&raw$migrant==1])
general[3,4] <- mean(raw$a43c[raw$a2=="男"&raw$migrant==0])
general[4,4] <- mean(raw$a43c[raw$a2=="女"&raw$migrant==0])
melt_gen <- melt(general)
melt_gen$var <- 0
melt_gen$var[melt_gen$variable=="before"] <- 10
melt_gen$var[melt_gen$variable=="now"] <- 20
melt_gen$var[melt_gen$variable=="later"] <- 30
melt_gen$var[(melt_gen$cat=="LFemale" | melt_gen$cat=="MFemale")
& melt_gen$variable=="before"] <- 13
melt_gen$var[(melt_gen$cat=="LFemale" | melt_gen$cat=="MFemale")
& melt_gen$variable=="now"] <- 23
melt_gen$var[(melt_gen$cat=="LFemale" | melt_gen$cat=="MFemale")
& melt_gen$variable=="later"] <- 33
ggplot(melt_gen, aes(x=var, y=value, color=cat)) +
geom_step(size=1.5)+
theme(legend.position="right",panel.background = element_rect(fill = "white"),
panel.border= element_blank())
migrant <- subset(raw, raw$migrant==1)
bothm <- data.frame(cat=c("RMale", "RFemale", "UMale", "UFemale"))
bothm <- data.frame(cat=c("RMale", "RFemale", "UMale", "UFemale"))
bothm$before <- 0
bothm[1,2] <- mean(migrant$a43b[migrant$a2=="男"&migrant$a18=="农业户口"])
bothm[2,2] <- mean(migrant$a43b[migrant$a2=="女"&migrant$a18=="农业户口"])
bothm[3,2] <- mean(migrant$a43b[migrant$a2=="男"&migrant$a18!="农业户口"])
bothm[4,2] <- mean(migrant$a43b[migrant$a2=="女"&migrant$a18!="农业户口"])
bothm$now <- 0
bothm[1,3] <- mean(migrant$a43a[migrant$a2=="男"&migrant$a18=="农业户口"])
bothm[2,3] <- mean(migrant$a43a[migrant$a2=="女"&migrant$a18=="农业户口"])
bothm[3,3] <- mean(migrant$a43a[migrant$a2=="男"&migrant$a18!="农业户口"])
bothm[4,3] <- mean(migrant$a43a[migrant$a2=="女"&migrant$a18!="农业户口"])
bothm$later <- 0
bothm[1,4] <- mean(migrant$a43c[migrant$a2=="男"&migrant$a18=="农业户口"])
bothm[2,4] <- mean(migrant$a43c[migrant$a2=="女"&migrant$a18=="农业户口"])
bothm[3,4] <- mean(migrant$a43c[migrant$a2=="男"&migrant$a18!="农业户口"])
bothm[4,4] <- mean(migrant$a43c[migrant$a2=="女"&migrant$a18!="农业户口"])
melt_m <- melt(bothm)
melt_m$var <- 0
melt_m$var[melt_m$variable=="before"] <- 10
melt_m$var[melt_m$variable=="now"] <- 20
melt_m$var[melt_m$variable=="later"] <- 30
melt_m$var[(melt_m$cat=="UFemale" | melt_m$cat=="RFemale")
& melt_m$variable=="before"] <- 13
melt_m$var[(melt_m$cat=="UFemale" | melt_m$cat=="RFemale")
& melt_m$variable=="now"] <- 23
melt_m$var[(melt_m$cat=="UFemale" | melt_m$cat=="RFemale")
& melt_m$variable=="later"] <- 33
ggplot(melt_m, aes(x=var, y=value, color=cat)) +
geom_step(size=1.5)+
theme(legend.position="right",panel.background = element_rect(fill = "white"),
panel.border= element_blank())
View(bothm)
View(bothm)
plots <- list()
for (i in c("北京市", "上海市","天津市","浙江省","广东省","四川省","湖南省")) {
migrant <- subset(migrant, migrant$province==i)
bothm <- data.frame(cat=c("RMale", "RFemale", "UMale", "UFemale"))
bothm$before <- 0
bothm[1,2] <- mean(migrant$a43b[migrant$a2=="男"&migrant$a18=="农业户口"])
bothm[2,2] <- mean(migrant$a43b[migrant$a2=="女"&migrant$a18=="农业户口"])
bothm[3,2] <- mean(migrant$a43b[migrant$a2=="男"&migrant$a18!="农业户口"])
bothm[4,2] <- mean(migrant$a43b[migrant$a2=="女"&migrant$a18!="农业户口"])
bothm$now <- 0
bothm[1,3] <- mean(migrant$a43a[migrant$a2=="男"&migrant$a18=="农业户口"])
bothm[2,3] <- mean(migrant$a43a[migrant$a2=="女"&migrant$a18=="农业户口"])
bothm[3,3] <- mean(migrant$a43a[migrant$a2=="男"&migrant$a18!="农业户口"])
bothm[4,3] <- mean(migrant$a43a[migrant$a2=="女"&migrant$a18!="农业户口"])
bothm$later <- 0
bothm[1,4] <- mean(migrant$a43c[migrant$a2=="男"&migrant$a18=="农业户口"])
bothm[2,4] <- mean(migrant$a43c[migrant$a2=="女"&migrant$a18=="农业户口"])
bothm[3,4] <- mean(migrant$a43c[migrant$a2=="男"&migrant$a18!="农业户口"])
bothm[4,4] <- mean(migrant$a43c[migrant$a2=="女"&migrant$a18!="农业户口"])
melt_m <- melt(bothm)
melt_m$var <- 0
melt_m$var[melt_m$variable=="before"] <- 10
melt_m$var[melt_m$variable=="now"] <- 20
melt_m$var[melt_m$variable=="later"] <- 30
melt_m$var[(melt_m$cat=="UFemale" | melt_m$cat=="RFemale")
& melt_m$variable=="before"] <- 13
melt_m$var[(melt_m$cat=="UFemale" | melt_m$cat=="RFemale")
& melt_m$variable=="now"] <- 23
melt_m$var[(melt_m$cat=="UFemale" | melt_m$cat=="RFemale")
& melt_m$variable=="later"] <- 33
p1 <-ggplot(melt_m, aes(x=var, y=value, color=cat)) +
geom_step(size=1.5)+
theme(legend.position="right",panel.background = element_rect(fill = "white"),
panel.border= element_blank())
plots[[i]] <- p1
}
View(migrant)
for (i in c("北京市", "上海市","天津市","浙江省","广东省","四川省","湖南省")) {
migrant <- subset(migrant, province==i)
bothm <- data.frame(cat=c("RMale", "RFemale", "UMale", "UFemale"))
bothm$before <- 0
bothm[1,2] <- mean(migrant$a43b[migrant$a2=="男"&migrant$a18=="农业户口"])
bothm[2,2] <- mean(migrant$a43b[migrant$a2=="女"&migrant$a18=="农业户口"])
bothm[3,2] <- mean(migrant$a43b[migrant$a2=="男"&migrant$a18!="农业户口"])
bothm[4,2] <- mean(migrant$a43b[migrant$a2=="女"&migrant$a18!="农业户口"])
bothm$now <- 0
bothm[1,3] <- mean(migrant$a43a[migrant$a2=="男"&migrant$a18=="农业户口"])
bothm[2,3] <- mean(migrant$a43a[migrant$a2=="女"&migrant$a18=="农业户口"])
bothm[3,3] <- mean(migrant$a43a[migrant$a2=="男"&migrant$a18!="农业户口"])
bothm[4,3] <- mean(migrant$a43a[migrant$a2=="女"&migrant$a18!="农业户口"])
bothm$later <- 0
bothm[1,4] <- mean(migrant$a43c[migrant$a2=="男"&migrant$a18=="农业户口"])
bothm[2,4] <- mean(migrant$a43c[migrant$a2=="女"&migrant$a18=="农业户口"])
bothm[3,4] <- mean(migrant$a43c[migrant$a2=="男"&migrant$a18!="农业户口"])
bothm[4,4] <- mean(migrant$a43c[migrant$a2=="女"&migrant$a18!="农业户口"])
melt_m <- melt(bothm)
melt_m$var <- 0
melt_m$var[melt_m$variable=="before"] <- 10
melt_m$var[melt_m$variable=="now"] <- 20
melt_m$var[melt_m$variable=="later"] <- 30
melt_m$var[(melt_m$cat=="UFemale" | melt_m$cat=="RFemale")
& melt_m$variable=="before"] <- 13
melt_m$var[(melt_m$cat=="UFemale" | melt_m$cat=="RFemale")
& melt_m$variable=="now"] <- 23
melt_m$var[(melt_m$cat=="UFemale" | melt_m$cat=="RFemale")
& melt_m$variable=="later"] <- 33
p1 <-ggplot(melt_m, aes(x=var, y=value, color=cat)) +
geom_step(size=1.5)+
theme(legend.position="right",panel.background = element_rect(fill = "white"),
panel.border= element_blank())
plots[[i]] <- p1
}
plots
do.call("grid.arrange", c(plots, ncol=2, nrow=4))
library(gridExtra)
do.call("grid.arrange", c(plots, ncol=2, nrow=4))
migrant <- subset(raw, raw$migrant==1)
for (i in c("北京市", "上海市","天津市","浙江省","广东省","四川省","湖南省")) {
temp <- subset(migrant, province==i)
bothm <- data.frame(cat=c("RMale", "RFemale", "UMale", "UFemale"))
bothm$before <- 0
bothm[1,2] <- mean(migrant$a43b[migrant$a2=="男"&migrant$a18=="农业户口"])
bothm[2,2] <- mean(migrant$a43b[migrant$a2=="女"&migrant$a18=="农业户口"])
bothm[3,2] <- mean(migrant$a43b[migrant$a2=="男"&migrant$a18!="农业户口"])
bothm[4,2] <- mean(migrant$a43b[migrant$a2=="女"&migrant$a18!="农业户口"])
bothm$now <- 0
bothm[1,3] <- mean(migrant$a43a[migrant$a2=="男"&migrant$a18=="农业户口"])
bothm[2,3] <- mean(migrant$a43a[migrant$a2=="女"&migrant$a18=="农业户口"])
bothm[3,3] <- mean(migrant$a43a[migrant$a2=="男"&migrant$a18!="农业户口"])
bothm[4,3] <- mean(migrant$a43a[migrant$a2=="女"&migrant$a18!="农业户口"])
bothm$later <- 0
bothm[1,4] <- mean(migrant$a43c[migrant$a2=="男"&migrant$a18=="农业户口"])
bothm[2,4] <- mean(migrant$a43c[migrant$a2=="女"&migrant$a18=="农业户口"])
bothm[3,4] <- mean(migrant$a43c[migrant$a2=="男"&migrant$a18!="农业户口"])
bothm[4,4] <- mean(migrant$a43c[migrant$a2=="女"&migrant$a18!="农业户口"])
melt_m <- melt(bothm)
melt_m$var <- 0
melt_m$var[melt_m$variable=="before"] <- 10
melt_m$var[melt_m$variable=="now"] <- 20
melt_m$var[melt_m$variable=="later"] <- 30
melt_m$var[(melt_m$cat=="UFemale" | melt_m$cat=="RFemale")
& melt_m$variable=="before"] <- 13
melt_m$var[(melt_m$cat=="UFemale" | melt_m$cat=="RFemale")
& melt_m$variable=="now"] <- 23
melt_m$var[(melt_m$cat=="UFemale" | melt_m$cat=="RFemale")
& melt_m$variable=="later"] <- 33
p1 <-ggplot(melt_m, aes(x=var, y=value, color=cat)) +
geom_step(size=1.5)+
theme(legend.position="right",panel.background = element_rect(fill = "white"),
panel.border= element_blank())
plots[[i]] <- p1
}
do.call("grid.arrange", c(plots, ncol=2, nrow=4))
ggplot(melt_gen, aes(x=var, y=value, color=cat)) +
geom_step(size=1.5)+
theme(legend.position="right",panel.background = element_rect(fill = "white"),
panel.border= element_blank())+
geom_text(aes(label = value), size = 3)
?geom_text
ggplot(melt_gen, aes(x=var, y=value, color=cat)) +
geom_step(size=1.5)+
theme(legend.position="right",panel.background = element_rect(fill = "white"),
panel.border= element_blank())+
geom_text(aes(label = value), size = 4, check_overlap = T)
ggplot(melt_gen, aes(x=var, y=value, color=cat)) +
geom_step(size=1.5)+
theme(legend.position="right",panel.background = element_rect(fill = "white"),
panel.border= element_blank())+
geom_text(aes(label = round(value,2)), size = 4, check_overlap = T)
geom_text(aes(label = round(value,2)), size = 4, color="#5e5e5e",check_overlap = T)
ggplot(melt_gen, aes(x=var, y=value, color=cat)) +
geom_step(size=1.5)+
theme(legend.position="right",panel.background = element_rect(fill = "white"),
panel.border= element_blank())+
geom_text(aes(label = round(value,2)), size = 4, color="#5e5e5e",check_overlap = T)
ggplot(melt_gen, aes(x=var, y=value, color=cat)) +
geom_step(size=1.5)+
theme(legend.position="right",panel.background = element_rect(fill = "white"),
panel.border= element_blank())+
geom_text(aes(label = round(value,2)), size = 8, color="#5e5e5e",check_overlap = T)
ggplot(melt_gen, aes(x=var, y=value, color=cat)) +
geom_step(size=1.5)+
theme(legend.position="right",panel.background = element_rect(fill = "white"),
panel.border= element_blank())+
geom_text(aes(label = round(value,2)), size = 6, color="#5e5e5e",check_overlap = T)
ggplot(melt_gen, aes(x=var, y=value, color=cat)) +
geom_step(size=1.5)+
theme(legend.position="right",panel.background = element_rect(fill = "white"),
panel.border= element_blank())+
geom_text(aes(label = round(value,2)), size = 5, check_overlap = T)
ggplot(melt_gen, aes(x=var, y=value, color=cat)) +
geom_step(size=1.5)+
theme(legend.position="right",panel.background = element_rect(fill = "white"),
panel.border= element_blank())+
geom_text(aes(label = round(value,2)), size = 5.5, check_overlap = T)
ggplot(melt_m, aes(x=var, y=value, color=cat)) +
geom_step(size=1.5)+
theme(legend.position="right",panel.background = element_rect(fill = "white"),
panel.border= element_blank())+
geom_text(aes(label = round(value,2)), size = 5.5, check_overlap = T)
ggplot(melt_gen, aes(x=var, y=value, color=cat)) +
geom_step(size=1.5)+
theme(legend.position="right",panel.background = element_rect(fill = "white"),
panel.border= element_blank())+
geom_text(aes(label = round(value,2)), size = 5.5, check_overlap = T)
ggplot(melt_gen, aes(x=var, y=value, color=cat)) +
geom_step(size=1.5)+
theme(legend.position="right",panel.background = element_rect(fill = "white"),
panel.border= element_blank())+
geom_text(aes(label = round(value,2)), size = 5, check_overlap = T)
ggplot(melt_gen, aes(x=var, y=value, color=cat)) +
geom_step(size=1.5)+
theme(legend.position="right",panel.background = element_rect(fill = "white"),
panel.border= element_blank())+
geom_text(aes(label = round(value,2)), size = 5)
ggplot(melt_m, aes(x=var, y=value, color=cat)) +
geom_step(size=1.5)+
theme(legend.position="right",panel.background = element_rect(fill = "white"),
panel.border= element_blank())+
geom_text(aes(label = round(value,2)), size = 5)
View(melt_gen)
setwd("E:\\学习相关\\R\\China-s-Internal-Migrants-and-Their-Lives\\Codes&Datasets\\Identity")
library(foreign)
library(reshape2)
library(ggplot2
library(ggplot2)
library(ggplot2)
raw <- read.dta("identity.dta")
raw$s41 <- as.character(raw$s41)
raw$province[raw$a221==""] <- raw$s41
raw <- subset(raw, raw$a18!="农业户口" | raw$a221!="")
raw$migrant <-1
raw$migrant[raw$a221==""] <- 0
View(raw)
raw$rich_poor <- 0
raw$rich_poor[raw$b7a=="富人"] <- 1
raw$rich_poor[raw$b7a=="穷人"] <- -1
raw$cat[raw$migrant==0] <- 1
raw$cat[raw$migrant==1&raw$a18!="农业户口"] <- 2
raw$cat[raw$migrant==1&raw$a18=="农业户口"] <- 3
raw$cadre_common <- 1
raw$cadre_common[raw$b7b=="说不清"] <- 0
raw$cadre_common[raw$b7b=="群众"] <- -1
raw$prop_prol <- 1
raw$cadre_common <- 1
raw$cadre_common[raw$b7b=="说不清"] <- 0
raw$cadre_common[raw$b7b=="群众"] <- -1
raw$urban_rural <- 1
raw$urban_rural[raw$b7c=="说不清"] <- 0
raw$urban_rural[raw$b7c=="乡下人"] <- -1
raw$prop_prol[raw$b7d=="说不清"] <- 0
raw$prop_prol[raw$b7d=="无产者"] <- -1
raw$manage <- 1
raw$manage[raw$b7e=="说不清"] <- 0
raw$manage[raw$b7e=="被管理者"] <- -1
raw$education <- 1
raw$education[raw$b7f=="说不清"] <- 0
raw$education[raw$b7f=="低学历者"] <- 0
raw$class <- 1
raw$class[raw$b7g=="说不清"] <- 0
raw$class[raw$b7g=="低学历者"] <- -1
raw$count <- 1
identify <- aggregate( count ~ rich_poor+cadre_common+urban_rural+prop_prol+manage+education+class,
data=raw, sum)
View(identify)
identify <- aggregate( count ~ cat+rich_poor+cadre_common+urban_rural+prop_prol+manage+education+class,
data=raw, sum)
identity$color <- "#5e5e5e"
identity$color[identity$cat==2] <- "#2CF8EF"
identity$color[identity$before==3] <- "#035d59"
identity <- aggregate( count ~ cat+rich_poor+cadre_common+urban_rural+prop_prol+manage+education+class,
data=raw, sum)
identity$color <- "#5e5e5e"
identity$color[identity$cat==2] <- "#2CF8EF"
identity$color[identity$before==3] <- "#035d59"
alluvial( identity[,2:8], freq=identity$count, xw=0.0, alpha=0.6,
gap.width=0.1, col= identity$color)
install_github("mbojan/alluvial", force=T)
library(devtools)
install_github("mbojan/alluvial", force=T)
library(alluvial)
alluvial( identity[,2:8], freq=identity$count, xw=0.0, alpha=0.6,
gap.width=0.1, col= identity$color)
View(identity)
alluvial( identity[,2:8], freq=identity$count, xw=0.0, alpha=0.6,
gap.width=0.1, col= identity$color, layer=identity$cat)
identity$color <- "#bcbcbc"
identity$color[identity$cat==2] <- "#2CF8EF"
identity$color[identity$before==3] <- "#035d59"
alluvial( identity[,2:8], freq=identity$count, xw=0.0, alpha=0.6,
gap.width=0.1, col= identity$color, layer=3-identity$cat)
raw$class[raw$b7g=="工人阶级"] <- -1
identity <- aggregate( count ~ cat+rich_poor+cadre_common+urban_rural+prop_prol+manage+education+class,
data=raw, sum)
identity$color <- "#bcbcbc"
identity$color[identity$cat==2] <- "#2CF8EF"
identity$color[identity$before==3] <- "#035d59"
alluvial( identity[,2:8], freq=identity$count, xw=0.0, alpha=0.6,
gap.width=0.1, col= identity$color, layer=3-identity$cat, hide=identity$count<=5)
View(raw)
raw$education <- 1
raw$education[raw$b7f=="说不清"] <- 0
raw$education[raw$b7f=="低学历者"] <- -1
raw$class <- 1
raw$class[raw$b7g=="说不清"] <- 0
raw$class[raw$b7g=="工人阶层"] <- -1
identity <- aggregate( count ~ cat+rich_poor+cadre_common+urban_rural+prop_prol+manage+education+class,
data=raw, sum)
identity$color <- "#bcbcbc"
identity$color[identity$cat==2] <- "#2CF8EF"
identity$color[identity$before==3] <- "#035d59"
alluvial( identity[,2:8], freq=identity$count, xw=0.0, alpha=0.6,
gap.width=0.1, col= identity$color, layer=3-identity$cat, hide=identity$count<=5)
alluvial( identity[,2:8], freq=identity$count, xw=0.0, alpha=0.8,
gap.width=0.1, col= identity$color, layer=3-identity$cat, hide=identity$count<=5)
alluvial( identity[,2:8], freq=identity$count, xw=0.0, alpha=1,
gap.width=0.1, col= identity$color, layer=3-identity$cat, hide=identity$count<=5)
identity$color[identity$cat==3] <- "#035d59"
alluvial( identity[,2:8], freq=identity$count, xw=0.0, alpha=1,
gap.width=0.1, col= identity$color, layer=3-identity$cat, hide=identity$count<=5)
setwd("E:\\学习相关\\R\\China-s-Internal-Migrants-and-Their-Lives\\Codes&Datasets\\Identity")
alluvial( identity[,2:8], freq=identity$count, xw=0.0, alpha=1,
gap.width=0.1, col= identity$color, layer=3-identity$cat, hide=identity$count<=40 & identity$cat==1)
?alluvial
alluvial( identity[,2:8], freq=identity$count, xw=0.0, alpha=1,blocks=T,
gap.width=0.1, col= identity$color, layer=3-identity$cat,
hide=identity$count<=40 & identity$cat==1)
alluvial( identity[,2:8], freq=identity$count, xw=0.0, alpha=1,blocks=F,
gap.width=0.1, col= identity$color, layer=3-identity$cat,
hide=identity$count<=40 & identity$cat==1)
alluvial( identity[,2:8], freq=identity$count, xw=0.0, alpha=1, borer=0,
gap.width=0.1, col= identity$color, layer=3-identity$cat,
hide=identity$count<=40 & identity$cat==1)
alluvial( identity[,2:8], freq=identity$count, xw=0.0, alpha=1, borer=0,
gap.width=0.1, col= identity$color, layer=3-identity$cat,
hide=identity$count<=100 & identity$cat==1)
alluvial( identity[,2:8], freq=identity$count, borer=0,
gap.width=0.1, col= identity$color, layer=3-identity$cat,
hide=identity$count<=100 & identity$cat==1)
alluvial( identity[,2:8], freq=identity$count, borer=0,
gap.width=0.1, col= identity$color, layer=3-identity$cat,
hide=identity$count<=50)
alluvial( identity[,2:8], freq=identity$count, borer=0,
gap.width=0.1, col= identity$color, layer=3-identity$cat,
hide=identity$count<=30)
alluvial( identity[,2:8], freq=identity$count, borer=0,
gap.width=0.1, col= identity$color, layer=3-identity$cat)
alluvial( identity[,2:8], freq=identity$count, border=0,
gap.width=0.1, col= identity$color, layer=3-identity$cat)
alluvial( identity[,2:8], freq=identity$count, border=0,
gap.width=0.1, col= identity$color, layer=3-identity$cat)
alluvial( identity[,2:8], freq=identity$count, border=0,
gap.width=0.1, col= identity$color, layer=3-identity$cat,
hide=identity$count<=10)
alluvial( identity[,2:8], freq=identity$count, border=0,
gap.width=0.1, col= identity$color, layer=3-identity$cat,
hide=identity$count<=20)
alluvial( identity[,2:8], freq=identity$count, border=0,
gap.width=0.1, col= identity$color, layer=3-identity$cat,
hide=identity$count<=30)
alluvial( identity[,2:8], freq=identity$count, border=0,
gap.width=0.1, col= identity$color, layer=3-identity$cat,
hide=identity$count<=25)
alluvial( identity[,2:8], freq=identity$count, border=0,
gap.width=0.1, col= identity$color, layer=3-identity$cat,
hide=identity$count<=20)
